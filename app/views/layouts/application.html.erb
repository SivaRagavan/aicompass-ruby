<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "AI Compass" %></title>
    <meta name="application-name" content="AI Compass">

    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll("[data-copy-link]").forEach((button) => {
          button.addEventListener("click", async () => {
            const link = button.dataset.copyLink;
            if (!link) return;
            try {
              await navigator.clipboard.writeText(link);
              const originalText = button.textContent;
              button.textContent = "Copied!";
              button.classList.add("is-copied");
              setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove("is-copied");
              }, 1800);
            } catch (error) {
              window.prompt("Copy the link:", link);
            }
          });
        });

        document.querySelectorAll("[data-pillar]").forEach((pill) => {
          const toggles = pill.querySelectorAll("[data-pillar-toggle]");
          const details = pill.querySelector("[data-pillar-metrics]");
          if (!toggles.length || !details) return;
          toggles.forEach((toggle) => {
            toggle.addEventListener("click", () => {
              details.classList.toggle("hidden");
            });
          });
        });

        document.querySelectorAll("form").forEach((form) => {
          form.addEventListener("turbo:submit-start", () => {
            form.querySelectorAll("[data-disable-on-submit]").forEach((link) => {
              link.classList.add("pointer-events-none", "opacity-60");
              link.setAttribute("aria-disabled", "true");
            });
          });

          form.addEventListener("turbo:submit-end", () => {
            form.querySelectorAll("[data-disable-on-submit]").forEach((link) => {
              link.classList.remove("pointer-events-none", "opacity-60");
              link.removeAttribute("aria-disabled");
            });
          });
        });
      });
    </script>
  </head>

  <body>
    <div class="min-h-screen bg-[var(--background)]">
      <header class="sticky top-0 z-10 border-b border-[var(--border)] bg-[var(--background)]">
        <div class="mx-auto flex w-full max-w-[1160px] items-center justify-between px-8 py-5">
          <%= link_to (current_user ? dashboard_path : root_path), class: "inline-flex items-center gap-3 text-[20px] font-semibold tracking-[-0.02em] text-[var(--primary)]" do %>
            <%= image_tag "/icon.png", alt: "Compass", class: "h-8 w-8 rounded-[10px] bg-white p-1 shadow-[0_10px_20px_rgba(31,41,51,0.12)]" %>
            <span>AI Compass</span>
          <% end %>
          <div class="flex gap-3">
            <% if current_user %>
              <%= button_to "Sign out", signout_path, method: :delete, class: "inline-flex items-center justify-center gap-2 rounded-full border border-[var(--border)] bg-transparent px-5 py-2.5 font-semibold text-[var(--primary)] shadow-none", form: { data: { turbo: false } } %>
            <% else %>
              <%= link_to "Sign in", signin_path, class: "inline-flex items-center justify-center gap-2 rounded-full bg-[var(--primary)] px-5 py-2.5 font-semibold text-[var(--primary-foreground)] shadow-[0_12px_24px_rgba(31,111,91,0.18)]" %>
            <% end %>
          </div>
        </div>
      </header>

      <main class="mx-auto w-full max-w-[1160px] px-8 py-14 pb-20 min-[900px]:min-w-[720px]">
        <% if notice %>
          <div class="mb-4 rounded-[12px] bg-[rgba(22,163,74,0.1)] px-4 py-3 text-sm text-green-700"><%= notice %></div>
        <% end %>
        <% if alert %>
          <div class="mb-4 rounded-[12px] bg-[rgba(220,38,38,0.1)] px-4 py-3 text-sm text-red-700"><%= alert %></div>
        <% end %>
        <%= yield %>
      </main>
    </div>
  </body>
</html>
