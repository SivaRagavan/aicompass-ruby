<div class="card">
  <% company_name = @assessment.company_name.presence || "your company" %>
  <h1>Assessment for <%= company_name %></h1>
  <% assessor_name = @assessment.exec_profile["name"].presence || "Assessor" %>
  <% completed_date = @assessment.updated_at.to_date.strftime("%b %d, %Y") %>
  <p class="card-subtitle">Completed by <%= assessor_name %> on <%= completed_date %></p>

  <div class="stat-grid">
    <div class="score-card">
      <% score_percent = @summary[:composite_score].to_f.round.clamp(0, 100) %>
      <div class="score-meta">
        <div class="score-title">
          <span>AICO Score</span>
          <span class="score-help" data-tooltip="AI Compass Outlook score based on module responses.">?</span>
        </div>
        <strong><%= score_percent %></strong>
      </div>
      <div class="score-track" style="--score: <%= score_percent %>%;"></div>
    </div>
  </div>

  <h2>Score Breakdown</h2>
  <div class="pillar-chart">
    <% @summary[:pillar_scores].each do |pillar| %>
      <% pillar_scores = @assessment.scores.select { |score| score["pillar_id"] == pillar[:pillar_id] } %>
      <% pillar_percent = pillar[:score].to_f.round.clamp(0, 100) %>
      <div class="pillar-bar" data-pillar>
        <button class="pillar-label" type="button" data-pillar-toggle>
          <span><%= pillar[:pillar_name] %></span>
          <strong><%= format("%.0f", pillar_percent) %></strong>
        </button>
        <div class="pillar-track" data-pillar-toggle>
          <span style="width: <%= [pillar_percent.round, 100].min %>%"></span>
        </div>
        <div class="pillar-metrics" data-pillar-metrics>
          <% pillar_scores.each do |score| %>
            <% metric = BenchmarkData.pillar_by_id(score["pillar_id"])&.[](:metrics)&.find { |item| item[:id] == score["metric_id"] } %>
            <% metric_percent = (score["score"].to_f / 3 * 100).round.clamp(0, 100) %>
            <div class="pillar-metric-row">
              <span><%= metric ? metric[:name] : score["metric_id"] %></span>
              <span>Score: <%= format("%.0f", metric_percent) %></span>
              <span>Questions: <%= metric ? metric[:questions].length : score["responses"].length %></span>
            </div>
          <% end %>
          <% if pillar_scores.empty? %>
            <% BenchmarkData.metrics_for_pillar(pillar[:pillar_id]).each do |metric| %>
              <div class="pillar-metric-row">
                <span><%= metric[:name] %></span>
                <span>Score: 0</span>
                <span>Questions: <%= metric[:questions].length %></span>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>


</div>
