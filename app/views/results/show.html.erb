<div class="card">
  <% company_name = @assessment.company_name.presence || "your company" %>
  <h1>Assessment for <%= company_name %></h1>
  <% assessor_name = @assessment.exec_profile["name"].presence || "Assessor" %>
  <% completed_date = @assessment.updated_at.to_date.strftime("%b %d, %Y") %>
  <p class="card-subtitle">Completed by <%= assessor_name %> on <%= completed_date %></p>

  <div class="stat-grid">
    <div class="score-card">
      <% score_percent = @summary[:composite_score].to_f.round %>
      <div class="score-track" style="--score: <%= score_percent %>%;">
        <span class="score-indicator"></span>
        <span class="score-band"><%= @summary[:maturity_band] %></span>
      </div>
      <div class="score-meta">
        <span>Score</span>
        <strong><%= score_percent %></strong>
      </div>
    </div>
  </div>

  <h2>Breakdown</h2>
  <div class="pillar-chart">
    <% @summary[:pillar_scores].each do |pillar| %>
      <% pillar_scores = @assessment.scores.select { |score| score["pillar_id"] == pillar[:pillar_id] } %>
      <div class="pillar-bar" data-pillar>
        <button class="pillar-label" type="button" data-pillar-toggle>
          <span><%= pillar[:pillar_name] %></span>
          <strong><%= format("%.1f", pillar[:score]) %></strong>
        </button>
        <div class="pillar-track">
          <span style="width: <%= pillar[:score].to_f.round %>%"></span>
        </div>
        <div class="pillar-metrics" data-pillar-metrics>
          <% pillar_scores.each do |score| %>
            <% metric = BenchmarkData.pillar_by_id(score["pillar_id"])&.[](:metrics)&.find { |item| item[:id] == score["metric_id"] } %>
            <div class="pillar-metric-row">
              <span><%= metric ? metric[:name] : score["metric_id"] %></span>
              <span><%= format("%.1f", score["score"].to_f) %></span>
              <span><%= metric ? metric[:questions].length : score["responses"].length %> questions</span>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>


</div>
