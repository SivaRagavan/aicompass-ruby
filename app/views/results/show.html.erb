<div class="card">
  <h1>Assessment Results</h1>
  <p class="card-subtitle">Summary for <%= @assessment.company_name.presence || "your company" %>.</p>

  <div class="stat-grid">
    <div class="stat-card">
      <div style="font-size: 28px; font-weight: 700;"><%= format("%.1f", @summary[:composite_score]) %></div>
      <div class="small-text">Composite Score</div>
    </div>
    <div class="stat-card">
      <span class="badge"><%= @summary[:maturity_band] %></span>
      <div class="small-text">Maturity Band</div>
    </div>
  </div>

  <h2>Pillar Snapshot</h2>
  <div class="pillar-chart">
    <% @summary[:pillar_scores].each do |pillar| %>
      <% pillar_scores = @assessment.scores.select { |score| score["pillar_id"] == pillar[:pillar_id] } %>
      <div class="pillar-bar" data-pillar>
        <button class="pillar-label" type="button" data-pillar-toggle>
          <span><%= pillar[:pillar_name] %></span>
          <strong><%= format("%.1f", pillar[:score]) %></strong>
        </button>
        <div class="pillar-track">
          <span style="width: <%= pillar[:score].to_f.round %>%"></span>
        </div>
        <div class="pillar-metrics" data-pillar-metrics>
          <% pillar_scores.each do |score| %>
            <% metric = BenchmarkData.pillar_by_id(score["pillar_id"])&.[](:metrics)&.find { |item| item[:id] == score["metric_id"] } %>
            <div class="pillar-metric-row">
              <span><%= metric ? metric[:name] : score["metric_id"] %></span>
              <span><%= format("%.1f", score["score"].to_f) %></span>
              <span><%= metric ? metric[:questions].length : score["responses"].length %> questions</span>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>


</div>
