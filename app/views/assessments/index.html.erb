<div class="stack">
  <div>
    <h1>Company Assessments</h1>
    <p class="card-subtitle">
      Track AI maturity across company assessments and invite executives to respond.
    </p>
    <div class="card-footer">
      <%= link_to "New assessment", new_assessment_path, class: "button" %>
    </div>
  </div>

  <h2>Active assessments</h2>
  <% active_assessments = @assessments.reject { |assessment| assessment.status == "cancelled" } %>
  <% cancelled_assessments = @assessments.select { |assessment| assessment.status == "cancelled" } %>
  <% if active_assessments.empty? %>
    <p class="small-text">No active assessments yet.</p>
  <% else %>
    <div class="stack">
      <% active_assessments.each do |assessment| %>
        <div class="card">
          <div class="inline-meta">
            <strong><%= assessment.company_name %></strong>
            <span>Invite expires <%= assessment.invite_expires_at.to_date.to_s %></span>
            <span class="status-pill active">Active</span>
          </div>
          <div class="inline-meta">
            <span><%= assessment_progress_label(assessment) %></span>
            <span>Invite link: <%= invite_link(assessment) %></span>
          </div>
          <div class="card-footer">
            <%= link_to "Start", invite_path(assessment.invite_token), class: "button outline small" %>
            <%= link_to "Copy invite link", invite_link(assessment), class: "button ghost small" %>
            <%= button_to "Cancel", assessment_path(assessment), method: :patch, params: { status: "cancelled" }, class: "button ghost small", form: { data: { turbo: false } } %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

  <% if cancelled_assessments.any? %>
    <h2>Cancelled assessments</h2>
    <div class="stack">
      <% cancelled_assessments.each do |assessment| %>
        <div class="card">
          <div class="inline-meta">
            <strong><%= assessment.company_name %></strong>
            <span>Invite expired <%= assessment.invite_expires_at.to_date.to_s %></span>
            <span class="status-pill cancelled">Cancelled</span>
          </div>
          <div class="inline-meta">
            <span><%= assessment_progress_label(assessment) %></span>
            <span>Invite link: <%= invite_link(assessment) %></span>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
