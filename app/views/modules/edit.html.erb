<div class="card">
  <h1>Modules</h1>
  <p class="card-subtitle">Confirm the modules to include in this assessment.</p>

  <%= form_with url: modules_path(@assessment.invite_token), method: :patch, class: "form-grid" do %>
    <div class="module-list">
      <% @pillars.each do |pillar| %>
        <% checked = @assessment.selections.any? { |item| item["pillar_id"] == pillar[:id] && item["selected"] } %>
        <label class="module-row">
          <span class="module-check">
            <%= check_box_tag "pillars[]", pillar[:id], checked %>
          </span>
          <span class="module-name"><%= pillar[:name] %></span>
          <span class="module-meta">
            <%= pillar[:metrics].length %> metrics Â·
            <%= pillar[:metrics].sum { |metric| metric[:questions].length } %> questions
          </span>
        </label>
      <% end %>
    </div>

    <div class="card-footer">
      <%= submit_tag "Start Modules", class: "button" %>
      <%= link_to "Back", qualify_path(@assessment.invite_token), class: "button secondary" %>
    </div>
  <% end %>
</div>
